# ガチャシステムの振る舞い

## Feature: ガチャを回す

### Scenario: 単発ガチャを回す
  Given プレイヤーが100コイン以上持っている
  And ガチャ画面が開いている
  When 単発ガチャボタンを押す
  Then 100コインが消費される
  And ガチャアニメーションが再生される
  And ランダムにボトルが1つ選ばれる
  And 結果が表示される
  And ボトルがインベントリに追加される

### Scenario: 10連ガチャを回す
  Given プレイヤーが900コイン以上持っている
  And ガチャ画面が開いている
  When 10連ガチャボタンを押す
  Then 900コインが消費される
  And ガチャアニメーションが再生される
  And ランダムにボトルが10個選ばれる
  And 結果が表示される
  And ボトルがインベントリに追加される

### Scenario: コイン不足
  Given プレイヤーのコインが100未満
  When ガチャ画面を開く
  Then 単発ガチャボタンが無効化されている
  And 10連ガチャボタンが無効化されている


## Feature: ガチャ確率

### Scenario: レアリティ抽選
  Given ガチャを回す
  Then 以下の確率でレアリティが決定される
    | レアリティ | 確率 |
    | ★         | 70%  |
    | ★★        | 20%  |
    | ★★★       | 7%   |
    | ★★★★      | 2.5% |
    | ★★★★★     | 0.5% |

### Scenario: 10連ガチャの保証
  Given 10連ガチャを回す
  Then 最低1つは★★★以上が出る（天井保証）


## Feature: ボトル選択

### Scenario: ボトルを選択する
  Given ボトル選択画面が開いている
  And 複数のボトルを所持している
  When ボトルをタップする
  Then プレビューが表示される
  And 「このボトルを使う」ボタンが有効になる

### Scenario: ボトルを決定する
  Given ボトルをプレビュー中
  When 「このボトルを使う」ボタンを押す
  Then 選択ボトルが更新される
  And ボトル選択画面が閉じる
  And メイン画面のボトル表示が更新される

### Scenario: 既に選択中のボトル
  Given ボトル選択画面が開いている
  When 現在選択中のボトルをタップする
  Then 「選択中」と表示される
  And 選択ボタンは無効化されている
